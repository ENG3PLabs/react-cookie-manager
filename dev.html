<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cookie Manager Development</title>
    <link rel="stylesheet" href="dist/wordpress/cookie-manager.css" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        margin: 0;
        padding: 20px;
        line-height: 1.6;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      .debug-panel {
        margin-top: 20px;
        padding: 15px;
        background: #f5f5f5;
        border-radius: 8px;
      }
      .debug-panel button {
        margin: 5px;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        background: #0070f3;
        color: white;
        cursor: pointer;
      }
      .debug-panel button:hover {
        background: #0051cc;
      }
      pre {
        background: #fff;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
      .state-panel {
        margin-top: 20px;
        padding: 15px;
        background: #e0e0e0;
        border-radius: 8px;
      }
      .config-panel {
        margin-bottom: 20px;
        padding: 15px;
        background: #e8f0fe;
        border-radius: 8px;
      }
      .config-group {
        margin-bottom: 15px;
      }
      .config-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }
      select {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ccc;
        background: white;
        min-width: 200px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Cookie Manager Development</h1>

      <div class="config-panel">
        <h2>Configuration</h2>
        <div class="config-group">
          <label for="displayType">Display Type:</label>
          <select id="displayType" onchange="updateConfig()">
            <option value="banner">Banner</option>
            <option value="modal">Modal</option>
            <option value="popup">Popup</option>
          </select>
        </div>
        <div class="config-group">
          <label for="theme">Theme:</label>
          <select id="theme" onchange="updateConfig()">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </div>
      </div>

      <div class="debug-panel">
        <h2>Debug Panel</h2>
        <button onclick="window.CookieKit.showBanner()">Show Banner</button>
        <button onclick="window.CookieKit.showCustomizeModal()">
          Show Customize Modal
        </button>
        <button onclick="window.CookieKit.resetConsent()">Reset Consent</button>

        <div class="state-panel">
          <h3>Current Cookie State:</h3>
          <pre id="cookieState">No consent set</pre>
        </div>
      </div>
    </div>

    <script src="dist/wordpress/cookie-manager.js"></script>
    <script>
      // Function to update the cookie state display
      function updateCookieState() {
        const consent = document.cookie
          .split("; ")
          .find((row) => row.startsWith("cookie_consent="));

        const stateDisplay = document.getElementById("cookieState");
        if (consent) {
          const value = consent.split("=")[1];
          try {
            const parsed = JSON.parse(decodeURIComponent(value));
            stateDisplay.textContent = JSON.stringify(parsed, null, 2);
          } catch (e) {
            stateDisplay.textContent = value;
          }
        } else {
          stateDisplay.textContent = "No consent set";
        }
      }

      // Function to get current configuration
      function getConfig() {
        return {
          style: document.getElementById("displayType").value,
          theme: document.getElementById("theme").value,
        };
      }

      // Function to initialize CookieKit with current config
      function initCookieKit() {
        const config = getConfig();
        console.log("üîÑ Reinitializing CookieKit with config:", config);

        window.CookieKit.init({
          translations: {
            title: "Cookie Settings üç™",
            message:
              "We use cookies to improve your experience on our website. Choose which cookies you want to allow.",
            buttonText: "Accept All",
            declineButtonText: "Decline All",
            manageButtonText: "Manage Cookies",
            privacyPolicyText: "Privacy Policy",
            manageTitle: "Cookie Preferences",
            manageMessage: "Customize your cookie preferences below",
            manageEssentialTitle: "Essential Cookies",
            manageAnalyticsTitle: "Analytics",
            manageSocialTitle: "Social",
            manageAdvertTitle: "Advertising",
          },
          onAccept: () => {
            console.log("‚úÖ Cookies accepted");
          },
          onDecline: () => {
            console.log("‚ùå Cookies declined");
          },
          onManage: (categories) => {
            console.log("‚öôÔ∏è Cookie preferences updated:", categories);
          },
          showManageButton: true,
          privacyPolicyUrl: "https://example.com/privacy",
          ...config,
        });
      }

      // Function to update configuration
      function updateConfig() {
        console.log("üßπ Cleaning up existing elements");

        // Remove all cookie manager elements
        document
          .querySelectorAll(".cookie-manager")
          .forEach((el) => el.remove());

        // Remove any modals, overlays, or banners that might be outside cookie-manager
        document
          .querySelectorAll("[class*='cookie']")
          .forEach((el) => el.remove());

        // Clear the cookie to force a fresh state
        document.cookie =
          "cookie_consent=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";

        console.log("‚ú® Initializing with new configuration");
        // Reinitialize with new config
        initCookieKit();

        // Use the existing instance to show the banner
        if (window.CookieKit.manager) {
          window.CookieKit.manager.createBanner();
          window.CookieKit.manager.createCustomizeModal();
        }
      }

      // Update state every second
      setInterval(updateCookieState, 1000);

      // Listen for consent updates
      window.addEventListener("cookiekit:consent-updated", (event) => {
        console.log("üç™ Consent updated:", event.detail);
        updateCookieState();
      });

      // Initial initialization
      initCookieKit();
    </script>
  </body>
</html>
